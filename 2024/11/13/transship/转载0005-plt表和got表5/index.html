<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>转载0005 plt表和got表5 | Phaero的世外桃源</title><meta name="author" content="Phaero"><meta name="copyright" content="Phaero"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言本文转载自知乎，仅用作存储用。 再看动态链接中的PLT和GOT - 读懂原理与细节 作者主页：红色的红 正文 原背景   魔鬼都藏在细节中, 不深入细节我总以为我已经懂了. 此文就是用于解决所有细节的落脚。  待解决的疑问： 动态库中的PLT表与主程序中的PLT表是否为同一份。 动态库中的GOT.PLT表与主程序中的GOT.PLT表是否为同一份。 PLT表是代码还是数据。 动态库内部函数之间的">
<meta property="og:type" content="article">
<meta property="og:title" content="转载0005 plt表和got表5">
<meta property="og:url" content="https://blog.phaero.cn/2024/11/13/transship/%E8%BD%AC%E8%BD%BD0005-plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A85/index.html">
<meta property="og:site_name" content="Phaero的世外桃源">
<meta property="og:description" content="前言本文转载自知乎，仅用作存储用。 再看动态链接中的PLT和GOT - 读懂原理与细节 作者主页：红色的红 正文 原背景   魔鬼都藏在细节中, 不深入细节我总以为我已经懂了. 此文就是用于解决所有细节的落脚。  待解决的疑问： 动态库中的PLT表与主程序中的PLT表是否为同一份。 动态库中的GOT.PLT表与主程序中的GOT.PLT表是否为同一份。 PLT表是代码还是数据。 动态库内部函数之间的">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.phaero.cn/image/sky.jpg">
<meta property="article:published_time" content="2024-11-13T15:42:02.000Z">
<meta property="article:modified_time" content="2024-11-13T18:32:26.499Z">
<meta property="article:author" content="Phaero">
<meta property="article:tag" content="转载">
<meta property="article:tag" content="glibc">
<meta property="article:tag" content="plt">
<meta property="article:tag" content="got">
<meta property="article:tag" content="动态链接">
<meta property="article:tag" content="重定位">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.phaero.cn/image/sky.jpg"><link rel="shortcut icon" href="/image/favicon.ico"><link rel="canonical" href="https://blog.phaero.cn/2024/11/13/transship/%E8%BD%AC%E8%BD%BD0005-plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A85/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '转载0005 plt表和got表5',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/image/sky.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/image/background.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Phaero的世外桃源</span></a><a class="nav-page-title" href="/"><span class="site-name">转载0005 plt表和got表5</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">转载0005 plt表和got表5</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-11-13T15:42:02.000Z" title="发表于 2024-11-13 23:42:02">2024-11-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-11-13T18:32:26.499Z" title="更新于 2024-11-14 02:32:26">2024-11-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BD%AC%E8%BD%BD/">转载</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BD%AC%E8%BD%BD/ctf/">ctf</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BD%AC%E8%BD%BD/ctf/pwn/">pwn</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本文转载自知乎，仅用作存储用。</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/558522498">再看动态链接中的PLT和GOT - 读懂原理与细节</a></p>
<p>作者主页：<a target="_blank" rel="noopener" href="https://www.zhihu.com/people/li-jian-hong-13-63">红色的红</a></p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><p><img src="/image/post/transship/0005/1.jpg" alt="原背景"></p>
<center>原背景</center>

<ul>
<li>魔鬼都藏在细节中, 不深入细节我总以为我已经懂了. 此文就是用于解决所有细节的落脚。</li>
</ul>
<h2 id="待解决的疑问："><a href="#待解决的疑问：" class="headerlink" title="待解决的疑问："></a>待解决的疑问：</h2><ul>
<li>动态库中的PLT表与主程序中的PLT表是否为同一份。</li>
<li>动态库中的GOT.PLT表与主程序中的GOT.PLT表是否为同一份。</li>
<li>PLT表是代码还是数据。</li>
<li>动态库内部函数之间的调用为何不直接使用相对地址调用。</li>
</ul>
<hr>
<ul>
<li>由于<code>.plt</code>段的作用(用于延时加载)不是 这篇文章的重点. 我们都知道其延时加载的原理和基本方法.这里就不额外展开说明这一点.可以参考内容[1][2].</li>
</ul>
<h2 id="代码准备"><a href="#代码准备" class="headerlink" title="代码准备"></a>代码准备</h2><ul>
<li>简单对代码作一个说明:</li>
<li><code>add.so</code> 会被编译为一个动态库. 里面包含两个函数:<ul>
<li>addtwo 完成两个数的加法.</li>
<li>addthree 完成</li>
</ul>
</li>
</ul>
<h3 id="main-c"><a href="#main-c" class="headerlink" title="main.c"></a><code>main.c</code></h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明一个外部导入的函数</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">addtwo</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">addthree</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> z)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> sum = addtwo(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;1+2=%d\n&quot;</span>,sum);</span><br><span class="line">  sum = addthree(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;1+2+3=%d\n&quot;</span>,sum);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="动态库-add-so"><a href="#动态库-add-so" class="headerlink" title="动态库: add.so"></a>动态库: <code>add.so</code></h3><p>源文件: <code>add.c</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">addtwo</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">  sum = x + y;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">addthree</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> z)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">  sum = addtwo(x,y)+z;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="makefile"><a href="#makefile" class="headerlink" title="makefile"></a>makefile</h3><p>一份”能用”的makefile,主要是用于记录编译参数. 方便重复输入：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">so:</span><br><span class="line">	gcc -m32 -g -Wl,-soname,add.so -shared -fPIC -o add.so add.c</span><br><span class="line">main:</span><br><span class="line">	gcc -m32 -g -Wl,-rpath,./ -o main.out main.c add.so</span><br></pre></td></tr></table></figure>
<h2 id="编译结果分析"><a href="#编译结果分析" class="headerlink" title="编译结果分析"></a>编译结果分析</h2><ul>
<li>我们着重对相关的<code>.dynamic</code>和相关的符号(<code>symbol</code>)和重定位表<code>rel.dyn</code>等进行详细分析。</li>
</ul>
<h3 id="分析-add-so"><a href="#分析-add-so" class="headerlink" title="分析: add.so"></a>分析: <code>add.so</code></h3><ul>
<li>命令: <code>objdump -d add.so</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line"> .add.so:     file format elf32-i386</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .init:</span><br><span class="line"></span><br><span class="line">000002dc &lt;_init&gt;:</span><br><span class="line"> 2dc:	55                   	push   %ebp</span><br><span class="line"> 2dd:	89 e5                	mov    %esp,%ebp</span><br><span class="line"> 2df:	53                   	push   %ebx</span><br><span class="line"> 2e0:	83 ec 04             	sub    $0x4,%esp</span><br><span class="line"> 2e3:	e8 00 00 00 00       	call   2e8 &lt;_init+0xc&gt;</span><br><span class="line"> 2e8:	5b                   	pop    %ebx</span><br><span class="line"> 2e9:	81 c3 cc 12 00 00    	add    $0x12cc,%ebx</span><br><span class="line"> 2ef:	8b 93 f4 ff ff     ff    	mov    -0xc(%ebx),%edx</span><br><span class="line"> 2f5:	85 d2                	test   %edx,%edx</span><br><span class="line"> 2f7:	74 05                	je     2fe &lt;_init+0x22&gt;</span><br><span class="line"> 2f9:	e8 1e 00 00 00       	call   31c &lt;__gmon_start__@plt&gt;</span><br><span class="line"> 2fe:	e8 cd 00 00 00       	call   3d0 &lt;frame_dummy&gt;</span><br><span class="line"> 303:	e8 68 01 00 00       	call   470 &lt;__do_global_ctors_aux&gt;</span><br><span class="line"> 308:	58                   	pop    %eax</span><br><span class="line"> 309:	5b                   	pop    %ebx</span><br><span class="line"> 30a:	c9                   	leave</span><br><span class="line"> 30b:	c3                   	ret</span><br><span class="line"></span><br><span class="line">; =====================================================</span><br><span class="line">; add.so 动态链接库的 .plt 段                        .</span><br><span class="line">; =====================================================</span><br><span class="line">Disassembly of section .plt:</span><br><span class="line"></span><br><span class="line">0000030c &lt;__gmon_start__@plt-0x10&gt;:</span><br><span class="line"> 30c:	ff b3 04 00 00 00    	pushl  0x4(%ebx)</span><br><span class="line"> 312:	ff a3 08 00 00 00    	jmp    *0x8(%ebx)</span><br><span class="line"> 318:	00 00                	add    %al,(%eax)</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">0000031c &lt;__gmon_start__@plt&gt;:</span><br><span class="line"> 31c:	ff a3 0c 00 00 00    	jmp    *0xc(%ebx)</span><br><span class="line"> 322:	68 00 00 00 00       	push   $0x0</span><br><span class="line"> 327:	e9 e0 ff ff ff       	jmp    30c &lt;_init+0x30&gt;</span><br><span class="line"></span><br><span class="line">0000032c &lt;addtwo@plt&gt;:</span><br><span class="line"> 32c:	ff a3 10 00 00 00    	jmp    *0x10(%ebx)</span><br><span class="line"> 332:	68 08 00 00 00       	push   $0x8</span><br><span class="line"> 337:	e9 d0 ff ff ff       	jmp    30c &lt;_init+0x30&gt;</span><br><span class="line"></span><br><span class="line">0000033c &lt;__cxa_finalize@plt&gt;:</span><br><span class="line"> 33c:	ff a3 14 00 00 00    	jmp    *0x14(%ebx)</span><br><span class="line"> 342:	68 10 00 00 00       	push   $0x10</span><br><span class="line"> 347:	e9 c0 ff ff ff       	jmp    30c &lt;_init+0x30&gt;</span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line">00000350 &lt;__do_global_dtors_aux&gt;:</span><br><span class="line"> 350:	55                   	push   %ebp</span><br><span class="line"> 351:	89 e5                	mov    %esp,%ebp</span><br><span class="line"> 353:	56                   	push   %esi</span><br><span class="line"> 354:	53                   	push   %ebx</span><br><span class="line"> 355:	e8 ad 00 00 00       	call   407 &lt;__i686.get_pc_thunk.bx&gt;</span><br><span class="line"> 35a:	81 c3 5a 12 00 00    	add    $0x125a,%ebx</span><br><span class="line"> 360:	83 ec 10             	sub    $0x10,%esp</span><br><span class="line"> 363:	80 bb 18 00 00 00 00 	cmpb   $0x0,0x18(%ebx)</span><br><span class="line"> 36a:	75 5d                	jne    3c9 &lt;__do_global_dtors_aux+0x79&gt;</span><br><span class="line"> 36c:	8b 83 fc ff ff ff    	mov    -0x4(%ebx),%eax</span><br><span class="line"> 372:	85 c0                	test   %eax,%eax</span><br><span class="line"> 374:	74 0e                	je     384 &lt;__do_global_dtors_aux+0x34&gt;</span><br><span class="line"> 376:	8d 83 28 ff ff ff    	lea    -0xd8(%ebx),%eax</span><br><span class="line"> 37c:	89 04 24             	mov    %eax,(%esp)</span><br><span class="line"> 37f:	e8 b8 ff ff ff       	call   33c &lt;__cxa_finalize@plt&gt;</span><br><span class="line"> 384:	8b 83 1c 00 00 00    	mov    0x1c(%ebx),%eax</span><br><span class="line"> 38a:	8d b3 20 ff ff ff    	lea    -0xe0(%ebx),%esi</span><br><span class="line"> 390:	8d 93 1c ff ff ff    	lea    -0xe4(%ebx),%edx</span><br><span class="line"> 396:	29 d6                	sub    %edx,%esi</span><br><span class="line"> 398:	c1 fe 02             	sar    $0x2,%esi</span><br><span class="line"> 39b:	83 ee 01             	sub    $0x1,%esi</span><br><span class="line"> 39e:	39 f0                	cmp    %esi,%eax</span><br><span class="line"> 3a0:	73 20                	jae    3c2 &lt;__do_global_dtors_aux+0x72&gt;</span><br><span class="line"> 3a2:	8d b6 00 00 00 00    	lea    0x0(%esi),%esi</span><br><span class="line"> 3a8:	83 c0 01             	add    $0x1,%eax</span><br><span class="line"> 3ab:	89 83 1c 00 00 00    	mov    %eax,0x1c(%ebx)</span><br><span class="line"> 3b1:	ff 94 83 1c ff ff ff 	call   *-0xe4(%ebx,%eax,4)</span><br><span class="line"> 3b8:	8b 83 1c 00 00 00    	mov    0x1c(%ebx),%eax</span><br><span class="line"> 3be:	39 f0                	cmp    %esi,%eax</span><br><span class="line"> 3c0:	72 e6                	jb     3a8 &lt;__do_global_dtors_aux+0x58&gt;</span><br><span class="line"> 3c2:	c6 83 18 00 00 00 01 	movb   $0x1,0x18(%ebx)</span><br><span class="line"> 3c9:	83 c4 10             	add    $0x10,%esp</span><br><span class="line"> 3cc:	5b                   	pop    %ebx</span><br><span class="line"> 3cd:	5e                   	pop    %esi</span><br><span class="line"> 3ce:	5d                   	pop    %ebp</span><br><span class="line"> 3cf:	c3                   	ret</span><br><span class="line"></span><br><span class="line">000003d0 &lt;frame_dummy&gt;:</span><br><span class="line"> 3d0:	55                   	push   %ebp</span><br><span class="line"> 3d1:	89 e5                	mov    %esp,%ebp</span><br><span class="line"> 3d3:	53                   	push   %ebx</span><br><span class="line"> 3d4:	e8 2e 00 00 00       	call   407 &lt;__i686.get_pc_thunk.bx&gt;</span><br><span class="line"> 3d9:	81 c3 db 11 00 00    	add    $0x11db,%ebx</span><br><span class="line"> 3df:	83 ec 14             	sub    $0x14,%esp</span><br><span class="line"> 3e2:	8b 93 24 ff ff ff    	mov    -0xdc(%ebx),%edx</span><br><span class="line"> 3e8:	85 d2                	test   %edx,%edx</span><br><span class="line"> 3ea:	74 15                	je     401 &lt;frame_dummy+0x31&gt;</span><br><span class="line"> 3ec:	8b 83 f8 ff ff ff    	mov    -0x8(%ebx),%eax</span><br><span class="line"> 3f2:	85 c0                	test   %eax,%eax</span><br><span class="line"> 3f4:	74 0b                	je     401 &lt;frame_dummy+0x31&gt;</span><br><span class="line"> 3f6:	8d 93 24 ff ff ff    	lea    -0xdc(%ebx),%edx</span><br><span class="line"> 3fc:	89 14 24             	mov    %edx,(%esp)</span><br><span class="line"> 3ff:	ff d0                	call   *%eax</span><br><span class="line"> 401:	83 c4 14             	add    $0x14,%esp</span><br><span class="line"> 404:	5b                   	pop    %ebx</span><br><span class="line"> 405:	5d                   	pop    %ebp</span><br><span class="line"> 406:	c3                   	ret</span><br><span class="line"></span><br><span class="line">00000407 &lt;__i686.get_pc_thunk.bx&gt;:</span><br><span class="line"> 407:	8b 1c 24             	mov    (%esp),%ebx</span><br><span class="line"> 40a:	c3                   	ret</span><br><span class="line"> 40b:	90                   	nop</span><br><span class="line"></span><br><span class="line">0000040c &lt;addtwo&gt;:</span><br><span class="line"> 40c:	55                   	push   %ebp</span><br><span class="line"> 40d:	89 e5                	mov    %esp,%ebp</span><br><span class="line"> 40f:	83 ec 10             	sub    $0x10,%esp</span><br><span class="line"> 412:	c7 45 fc 00 00 00 00 	movl   $0x0,-0x4(%ebp)</span><br><span class="line"> 419:	8b 45 0c             	mov    0xc(%ebp),%eax</span><br><span class="line"> 41c:	8b 55 08             	mov    0x8(%ebp),%edx</span><br><span class="line"> 41f:	8d 04 02             	lea    (%edx,%eax,1),%eax</span><br><span class="line"> 422:	89 45 fc             	mov    %eax,-0x4(%ebp)</span><br><span class="line"> 425:	8b 45 fc             	mov    -0x4(%ebp),%eax</span><br><span class="line"> 428:	c9                   	leave</span><br><span class="line"> 429:	c3                   	ret</span><br><span class="line"></span><br><span class="line">0000042a &lt;addthree&gt;:</span><br><span class="line"> 42a:	55                   	push   %ebp</span><br><span class="line"> 42b:	89 e5                	mov    %esp,%ebp</span><br><span class="line"> 42d:	53                   	push   %ebx</span><br><span class="line"> 42e:	83 ec 24             	sub    $0x24,%esp</span><br><span class="line"> 431:	e8 d1 ff ff ff       	call   407 &lt;__i686.get_pc_thunk.bx&gt;</span><br><span class="line"> 436:	81 c3 7e 11 00 00    	add    $0x117e,%ebx</span><br><span class="line"> 43c:	c7 45 f4 00 00 00 00 	movl   $0x0,-0xc(%ebp)</span><br><span class="line"> 443:	8b 45 0c             	mov    0xc(%ebp),%eax</span><br><span class="line"> 446:	89 44 24 04          	mov    %eax,0x4(%esp)</span><br><span class="line"> 44a:	8b 45 08             	mov    0x8(%ebp),%eax</span><br><span class="line"> 44d:	89 04 24             	mov    %eax,(%esp)</span><br><span class="line"> 450:	e8 d7 fe ff ff       	call   32c &lt;addtwo@plt&gt;</span><br><span class="line"> 455:	03 45 10             	add    0x10(%ebp),%eax</span><br><span class="line"> 458:	89 45 f4             	mov    %eax,-0xc(%ebp)</span><br><span class="line"> 45b:	8b 45 f4             	mov    -0xc(%ebp),%eax</span><br><span class="line"> 45e:	83 c4 24             	add    $0x24,%esp</span><br><span class="line"> 461:	5b                   	pop    %ebx</span><br><span class="line"> 462:	5d                   	pop    %ebp</span><br><span class="line"> 463:	c3                   	ret</span><br><span class="line"> 464:	90                   	nop</span><br><span class="line"> 465:	90                   	nop</span><br><span class="line"> 466:	90                   	nop</span><br><span class="line"> 467:	90                   	nop</span><br><span class="line"> 468:	90                   	nop</span><br><span class="line"> 469:	90                   	nop</span><br><span class="line"> 46a:	90                   	nop</span><br><span class="line"> 46b:	90                   	nop</span><br><span class="line"> 46c:	90                   	nop</span><br><span class="line"> 46d:	90                   	nop</span><br><span class="line"> 46e:	90                   	nop</span><br><span class="line"> 46f:	90                   	nop</span><br><span class="line"></span><br><span class="line">00000470 &lt;__do_global_ctors_aux&gt;:</span><br><span class="line"> 470:	55                   	push   %ebp</span><br><span class="line"> 471:	89 e5                	mov    %esp,%ebp</span><br><span class="line"> 473:	56                   	push   %esi</span><br><span class="line"> 474:	53                   	push   %ebx</span><br><span class="line"> 475:	e8 8d ff ff ff       	call   407 &lt;__i686.get_pc_thunk.bx&gt;</span><br><span class="line"> 47a:	81 c3 3a 11 00 00    	add    $0x113a,%ebx</span><br><span class="line"> 480:	8b 83 14 ff ff ff    	mov    -0xec(%ebx),%eax</span><br><span class="line"> 486:	83 f8 ff             	cmp    $0xffffffff,%eax</span><br><span class="line"> 489:	74 19                	je     4a4 &lt;__do_global_ctors_aux+0x34&gt;</span><br><span class="line"> 48b:	8d b3 14 ff ff ff    	lea    -0xec(%ebx),%esi</span><br><span class="line"> 491:	8d b4 26 00 00 00 00 	lea    0x0(%esi,%eiz,1),%esi</span><br><span class="line"> 498:	83 ee 04             	sub    $0x4,%esi</span><br><span class="line"> 49b:	ff d0                	call   *%eax</span><br><span class="line"> 49d:	8b 06                	mov    (%esi),%eax</span><br><span class="line"> 49f:	83 f8 ff             	cmp    $0xffffffff,%eax</span><br><span class="line"> 4a2:	75 f4                	jne    498 &lt;__do_global_ctors_aux+0x28&gt;</span><br><span class="line"> 4a4:	5b                   	pop    %ebx</span><br><span class="line"> 4a5:	5e                   	pop    %esi</span><br><span class="line"> 4a6:	5d                   	pop    %ebp</span><br><span class="line"> 4a7:	c3                   	ret</span><br><span class="line"></span><br><span class="line">Disassembly of section .fini:</span><br><span class="line"></span><br><span class="line">000004a8 &lt;_fini&gt;:</span><br><span class="line"> 4a8:	55                   	push   %ebp</span><br><span class="line"> 4a9:	89 e5                	mov    %esp,%ebp</span><br><span class="line"> 4ab:	53                   	push   %ebx</span><br><span class="line"> 4ac:	83 ec 04             	sub    $0x4,%esp</span><br><span class="line"> 4af:	e8 00 00 00 00       	call   4b4 &lt;_fini+0xc&gt;</span><br><span class="line"> 4b4:	5b                   	pop    %ebx</span><br><span class="line"> 4b5:	81 c3 00 11 00 00    	add    $0x1100,%ebx</span><br><span class="line"> 4bb:	e8 90 fe ff ff       	call   350 &lt;__do_global_dtors_aux&gt;</span><br><span class="line"> 4c0:	59                   	pop    %ecx</span><br><span class="line"> 4c1:	5b                   	pop    %ebx</span><br><span class="line"> 4c2:	c9                   	leave</span><br><span class="line"> 4c3:	c3                   	ret</span><br></pre></td></tr></table></figure>
<p>我们看到如下的代码:</p>
<p><img src="/image/post/transship/0005/2.jpg" alt=".PLT项的内容分析"></p>
<center>.PLT项的内容分析</center>

<p>结论:</p>
<ul>
<li>PLT 实际为代码段. 不是简单的数据段. 首先其内容不会变. 且内容的确为一些JMP相关的代码。</li>
<li>PLT的第一项地址为: 0x0000030C (这个是基于VMA基地址为0的虚拟地址)</li>
<li>上面的ebx的值实际为<code>.got.plt</code>段的基地址.(后面会证明)</li>
<li>使用<code>.got.plt</code>表进行间接寻址时,是从第4项开始的,即前三项进行了跳过。</li>
<li><code>.got.plt</code> 表项的大小为 <code>4字节</code></li>
<li><code>addtwo</code> 作为一个内部和外部都会调用的函数.在PLT中有自己的<strong>表项</strong>。</li>
<li><strong>注意：</strong> 而同时也作为外部函数的addthree 并<strong>没有自己的PLT项</strong>。</li>
</ul>
<h3 id="验证-ebx的内容是-got-plt基地址"><a href="#验证-ebx的内容是-got-plt基地址" class="headerlink" title="验证 ebx的内容是.got.plt基地址"></a>验证 ebx的内容是<code>.got.plt</code>基地址</h3><p>我 们先看一下<code>.got</code>的段信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 命令: objdump -j .got -h add.so</span><br><span class="line">add.so:     file format elf32-i386</span><br><span class="line"></span><br><span class="line">Sections:</span><br><span class="line">Idx Name          Size      VMA       LMA       File off  Algn</span><br><span class="line"> 18 .got          0000000c  000015a8  000015a8  000005a8  2**2</span><br><span class="line">                  CONTENTS, ALLOC, LOAD, DATA</span><br></pre></td></tr></table></figure>
<p>我们发现<code>.got</code>段的大小为<code>12</code>字节. 偏移地址为：<code>0x000015a8</code>，紧接着我们看一下<code>.got.plt</code>的信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 命令 objdump -j .got.plt  -h add.so</span><br><span class="line"></span><br><span class="line">add.so:     file format elf32-i386</span><br><span class="line"></span><br><span class="line">Sections:</span><br><span class="line">Idx Name          Size      VMA       LMA       File off  Algn</span><br><span class="line"> 19 .got.plt      00000018  000015b4  000015b4  000005b4  2**2</span><br><span class="line">                  CONTENTS, ALLOC, LOAD, DATA</span><br></pre></td></tr></table></figure>
<p><strong>重点：</strong> <code>.got.plt</code>的VMA是：<code>0x000015b4</code>；这个好像并不能说明什么。别急，我们看一下ebx的内容是怎么得到的，先看一下<code>addthree</code>中对<code>addtwo</code>的调用部分：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">0000040c &lt;addtwo&gt;:</span><br><span class="line"> 40c:	55                   	push   %ebp</span><br><span class="line"> 40d:	89 e5                	mov    %esp,%ebp</span><br><span class="line"> 40f:	83 ec 10             	sub    $0x10,%esp</span><br><span class="line"> 412:	c7 45 fc 00 00 00 00 	movl   $0x0,-0x4(%ebp)</span><br><span class="line"> 419:	8b 45 0c             	mov    0xc(%ebp),%eax</span><br><span class="line"> 41c:	8b 55 08             	mov    0x8(%ebp),%edx</span><br><span class="line"> 41f:	8d 04 02             	lea    (%edx,%eax,1),%eax</span><br><span class="line"> 422:	89 45 fc             	mov    %eax,-0x4(%ebp)</span><br><span class="line"> 425:	8b 45 fc             	mov    -0x4(%ebp),%eax</span><br><span class="line"> 428:	c9                   	leave</span><br><span class="line"> 429:	c3                   	ret</span><br><span class="line"></span><br><span class="line">0000042a &lt;addthree&gt;:</span><br><span class="line"> 42a:	55                   	push   %ebp</span><br><span class="line"> 42b:	89 e5                	mov    %esp,%ebp</span><br><span class="line"> 42d:	53                   	push   %ebx</span><br><span class="line"> 42e:	83 ec 24             	sub    $0x24,%esp</span><br><span class="line">;====:</span><br><span class="line"> 431:	e8 d1 ff ff ff       	call   407 &lt;__i686.get_pc_thunk.bx&gt; ;</span><br><span class="line"> 436:	81 c3 7e 11 00 00    	add    $0x117e,%ebx</span><br><span class="line"> 43c:	c7 45 f4 00 00 00 00 	movl   $0x0,-0xc(%ebp)</span><br><span class="line"> 443:	8b 45 0c             	mov    0xc(%ebp),%eax</span><br><span class="line"> 446:	89 44 24 04          	mov    %eax,0x4(%esp)</span><br><span class="line"> 44a:	8b 45 08             	mov    0x8(%ebp),%eax</span><br><span class="line"> 44d:	89 04 24             	mov    %eax,(%esp)</span><br><span class="line"> 450:	e8 d7 fe ff ff       	call   32c &lt;addtwo@plt&gt;</span><br><span class="line"> 455:	03 45 10             	add    0x10(%ebp),%eax</span><br><span class="line"> 458:	89 45 f4             	mov    %eax,-0xc(%ebp)</span><br><span class="line"> 45b:	8b 45 f4             	mov    -0xc(%ebp),%eax</span><br><span class="line"> 45e:	83 c4 24             	add    $0x24,%esp</span><br><span class="line"> 461:	5b                   	pop    %ebx</span><br><span class="line"> 462:	5d                   	pop    %ebp</span><br><span class="line"> 463:	c3                   	ret</span><br></pre></td></tr></table></figure>
<p>我们对计算的部分进行一下标注：</p>
<p><img src="/image/post/transship/0005/3.jpg" alt=""></p>
<center>在call addtwo@plt之前.ebx的值已经计算好为: 0x15B4</center>

<ul>
<li>与预期一致，因为这个库里面的所有的代码都是需要重定位的，没有静态可以确定位置的。</li>
</ul>
<p>再看一下动态段的重定位表：</p>
<p><img src="/image/post/transship/0005/4.jpg" alt=""></p>
<center>另外一个引用PLT表的地方：EBX仍然值为0x15B4</center>

<p>因此我们可以确定，当所有的调用到<code>.plt</code>段的时候，ebx都会提前初始化为<code>.got.plt</code>的段基地址。而在上面的PLT的表项中的代码中，在引用EBX进行JMP的时候，还会跟上一个表内偏移。</p>
<ul>
<li>第一个PLT项是一个common的项。没有用于跳转找目标函数。</li>
<li>从第二个PLT项开始安排为跳转项。每一个PLT项的大小为：16字节。因为每个表项之间的偏移为16字节。</li>
<li>PLT引用的<code>.got.plt</code>段前三个entry都没有用到. 根据书中的内容我们可知：</li>
</ul>
<p><img src="/image/post/transship/0005/5.jpg" alt=""></p>
<center>.got.plt中的前三项内容</center>

<h3 id="重定位表"><a href="#重定位表" class="headerlink" title="重定位表"></a>重定位表</h3><p>我们看一下重定位表的内容，按道理重定位表应该会对<code>.got</code>和<code>.got.plt</code>的内容进行重定位，因为动态链接库的装载地址是不确定的。因此<code>.got</code>项和<code>.got.plt</code>的内容都需要在装载时重定位。</p>
<p>先看一下非动态段的重定位表：</p>
<p><img src="/image/post/transship/0005/6.jpg" alt=""></p>
<center>没有需要重定位的的项</center>

<ul>
<li>与预期一致，因为这个库里面的所有的代码都是需要重定位的。没有静态可以确定位置的。</li>
</ul>
<p>再看一下动态段的重定位表：</p>
<p><img src="/image/post/transship/0005/7.jpg" alt=""></p>
<center>一样与预期一致</center>

<p>解读一下：</p>
<ul>
<li>同样没有函数: <code>addthree</code> 的符号的相关的重定位项. (并不代表<code>addthree</code>不需要重定位. 这是两个概念.)</li>
<li>里面有三个<code>R_386_JUMP_SLOT</code>类型的重定位项. 三个项的地址分别是:<ul>
<li>000015c0: <code>R_386_JUMP_SLOT</code></li>
<li>000015c4: <code>R_386_JUMP_SLOT</code></li>
<li>000015c8: <code>R_386_JUMP_SLOT</code></li>
</ul>
</li>
</ul>
<p>我们知道<code>.got.plt</code>的首地址是: <code>0x15B4</code>。而第一个<code>JUMP_SLOT</code>的地址是：<code>15B4+4*3</code> = <code>15C0</code> 和前面分析的跳过了前三项<code>got.plt</code>项保持一致。</p>
<h3 id="为什么没有addthree的plt项"><a href="#为什么没有addthree的plt项" class="headerlink" title="为什么没有addthree的plt项"></a>为什么没有<code>addthree</code>的<code>plt</code>项</h3><ul>
<li>这个问题其实非常重要。它将揭示<code>.plt</code>表项的本质。以及结合上面的PLT项是代码还是数据结合看就可以得出结论了。</li>
</ul>
<p>虽然我们的动态链接库同时导出了两个函数：<code>addtwo</code>和<code>addthree</code>；但是并不是两个函数都出现在了<code>.plt</code>中。而且只有一个被内部自己调用的<code>addtwo</code>函数有一个<code>.plt</code>表项. 这似乎隐约在说明一个问题：</p>
<ul>
<li><code>.plt</code>段是一个胶水代码段，他属于调用方，不属于被调用方。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">上面猜测是属于调用方，那似乎应该大概在main函数的主模块里面会有对应的```.plt```段，并且有相应的```addtwo```函数和```addthree```函数的入口，我们先来看一下：</span><br><span class="line"></span><br><span class="line">### ```main```模块中的```got.plt```</span><br><span class="line"></span><br><span class="line">下面是主模块中的```.plt```段，果不其然，我们在其中发现了两个```.plt```项：</span><br><span class="line"></span><br><span class="line">* ```addtwo@plt``` : ```0x08048400```</span><br><span class="line">* ```addthree@plt``` ```0x08048410```</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">* 由于在主程序模块中，不需要动态重定位，因此这些代码加载到内存虚拟空间的地址是确定的。</span><br><span class="line"></span><br><span class="line">![](/image/post/transship/0005/8.jpg)</span><br><span class="line">&lt;center&gt;主程序模块中的.plt段&lt;/center&gt;</span><br><span class="line"></span><br><span class="line">这样就可以进一步的确认：```.plt```模块是属于调用方，因为我们在调用方的代码中找到了两个动态模块中的函数的```.plt```入口，而在动态模块中并没有完整的两个入口。</span><br><span class="line"></span><br><span class="line">* 这其实与之前理解的plt可能属于数据段，然后由于延时加载的需要在```.got```的基础上，又加了一级```.plt```的**间接跳转**。这样这个```.plt```因为作用与```.got```类似。```.got```是一个全局偏移表，那似乎可以被所有的模块共用(现在还不能确定，后面会论证)。那```.plt```也一样，就像把一级指针的```.got```变成了两级指针的```.plt```加```.got```了。这个理解似乎没有什么问题，如果```.plt```是数据段的话。只是又加了一级对```.got```的间接寻址而已。如果```.plt```是全局共享的话，那其它模块在引用它的时候。需要：</span><br><span class="line">  - 要么绝对寻址地从一个地方call调用跳转到相应的```.plt```的地方。由于是绝对地址，而```.plt```有加载地址是不确定的。是动态的。那只有**加载时重定位**   的方式才能实现。那这个方式就决定了只有主模块在使用加载时重定位的方式进行修改地址。但是这个只能主模块适用。如果是其它的模块。比如另外的动态模块，那动态模块就必须得修改代码段才能正确引用到```.plt```的地址，这样就无法实现PIC的代码了，**因此结论不成立**。</span><br><span class="line">  - 如果是使用相对寻址。那就需要相对寻址的两者之间的地址不能变化。否则就不能相对寻址了。那这样其它模块与 这个动态模块的地址之间就产生了关联。违背了**动态模块地址无关性**的PIC模式。因此**结论也不成立**。</span><br><span class="line"></span><br><span class="line">这样：不管使用怎样的地址定位方式，其它模块都无法友好的使用当前动态模块的```.plt```入口，因此，```.plt```必不属于被调用方，它应该是调用方自己的一个附属的胶水代码。</span><br><span class="line"></span><br><span class="line">## ```.got.plt```段是否为进程全局唯一共享</span><br><span class="line"></span><br><span class="line">这样我们论证完```.plt```的归属后，接下来的问题就是确定```.got```段的唯一性与归属性的问题。</span><br><span class="line">* 先说一个引子：</span><br><span class="line">  - 问：我们最初成立```.got```段的目的是什么？</span><br><span class="line">  - 答：把代码中引用一个不确定的地址的情况下，需要重定位修改代码部分的重定位过程导致代码段不可变不成立的：地址引用，将其从代码中剥离出来。单独放到数据段。就像代码段中对一个变量的绝对地址引用，修改为从数据段的一个地址指针的间接引用，这样才能保证代码段的内容始终保持不变。然后数据段```.GOT```的内容动态的重定位到相应的目标符号。</span><br><span class="line"></span><br><span class="line">其实有了上面一段描述的推理后，那```.got```是否属于进程中所有共享对象统一使用。这个结论已经很明确了。那就是```.got```段是属于模块自身的一个数据段，而不是所有的模块共享，从上面的```.got```段会被一个代码段的地址相对地址引用，那就决定了```.got```必须与相对应的代码段保持稳定的相对距离，这样才能被代码用相对地址定位的方式进行访问到。而另外一方面，不同的代码段之间的相对位置又是不确定的。这就间接说明了，不同共享对象的之间的代码段的相对地址不确定，所以不同的代码段(不同的模块)之间使用的```.got```不是同一个表。虽然```.got```被称作```全局偏移表：global offset table```，但是他只属于模块本身。</span><br><span class="line"></span><br><span class="line">### main中的```.got.plt```地址：</span><br><span class="line"></span><br><span class="line">同样先看一下```.got```</span><br><span class="line"></span><br><span class="line">![](/image/post/transship/0005/9.jpg)</span><br><span class="line">&lt;center&gt;main模块中的.got段的信息&lt;/center&gt;</span><br><span class="line"></span><br><span class="line">我们可以看到的确在main模块中有```.got```段且其虚拟地址在这里已经确定下来：```080497c4```，这个与动态模块中的```.got```段的虚拟地址不一样，其虚拟地址为：```000015a8```，这两个的地址完全不一样。</span><br><span class="line"></span><br><span class="line">再看一下我们的目标：```.got.plt```</span><br><span class="line"></span><br><span class="line">![](/image/post/transship/0005/10.jpg)</span><br><span class="line">&lt;center&gt;main模块中的.got.plt&lt;/center&gt;</span><br><span class="line"></span><br><span class="line">同样我们看一下main中对```.got.plt```的引用有一些不一样：</span><br><span class="line"></span><br><span class="line">```asm</span><br><span class="line">Disassembly of section .plt:</span><br><span class="line"></span><br><span class="line">080483d0 &lt;__gmon_start__@plt-0x10&gt;:</span><br><span class="line"> 80483d0:	ff 35 cc 97 04 08    	pushl  0x80497cc</span><br><span class="line"> 80483d6:	ff 25 d0 97 04 08    	jmp    *0x80497d0</span><br><span class="line"> 80483dc:	00 00                	add    %al,(%eax)</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">080483e0 &lt;__gmon_start__@plt&gt;:</span><br><span class="line"> 80483e0:	ff 25 d4 97 04 08    	jmp    *0x80497d4</span><br><span class="line"> 80483e6:	68 00 00 00 00       	push   $0x0</span><br><span class="line"> 80483eb:	e9 e0 ff ff ff       	jmp    80483d0 &lt;_init+0x30&gt;</span><br></pre></td></tr></table></figure>
<p>我们发现：</p>
<ol>
<li>在main中对<code>.got.plt</code>的引用不再使用ebx寄存器进行基址相对寻址。</li>
<li>使用的第一个<code>.got.plt</code>项是<code>0x80497d4</code>。</li>
</ol>
<p>而我们上面说<code>.got.plt</code>的基地址是：<code>080497c8</code>，那前三项是被跳过了的即：<code>080497c8</code>,<code>080497cc</code>,<code>080497d0</code>，然后从<code>0x80497d4</code>开始，与前面所说的跳过前三项用于加载当前模块的动态依赖相关的信息有关系。</p>
<p>到此。所有的疑问都很清晰了，还有一点需要我们探究一下。那就是为什么main模块中对<code>.got.plt</code>引用不是使用的ebx进行寻址。而<code>add.so</code>中却是如此，其实啊，这个与两个模块的虚拟地址的确定与否有关系。</p>
<ul>
<li>主模块的加载虚拟地址是确定的。它是加载到进程中的第一个模块。他的地址在编译链接时就已经确认。在加载到内存的时候直接按照<code>program header</code>的信息加载到内存即可。因此：模块代码与got相关的位置是固定的，且是确定的。那在进行寻址的时候，直接使用一个固定的地址的间接引用即可。(即上面的:<code>jmp *0x80497d0</code>)</li>
<li>而动态模块在加载的时候其加载基地址是不确定的，因此需要使用ebx去动态的获取到当前代码加载的地址。这样才能够满足动态加载的需求。</li>
</ul>
<p>最后总结一下：plt是属于调用方的一段胶水代码。有多少个模块就可能存在多少个<code>.plt</code>段，而这个<code>.plt</code>段还是单独为这一个模块服务的。比如模块a调用了模块b。那a中就会有一个单独的<code>.plt</code>属于模块a用来间接寻址模块b。且这个<code>.plt</code>段会一个配套的<code>.got.plt</code>段来存储最后的真正的地址。那如果还有一个模块c也调用了模块b。那c需要一个自己的``.plt<code>和</code>.got.plt```来完成相同的工作。</p>
<p>由于有全局符号介入的机制的存在，即使是自己调用自己，那也需要在自己的模块里面生成一段<code>.plt</code>代码和相应的<code>.got.plt</code>入口来完成对自己的代码的“相对寻址”，虽然明明知道自己要调用的代码与自己的相对位置是多少。但是我们就是偏偏不能那样做。因为由于全局符号介入的关系，我们最终调用的符号自己，可能不真的我们自己。</p>
<p>下面我画了一个图来总结呈现下这个关系吧，以防止你和我一样被绕晕：</p>
<p><img src="/image/post/transship/0005/1.jpg" alt=""></p>
<center>不同模块之间的.plt和.got.plt 之间的关系</center>

<h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><p>最后我们还是以问题结束吧：</p>
<ul>
<li>动态库中的PLT表与主程序中的PLT表是否为同一份？<ul>
<li>答：不是同一份</li>
</ul>
</li>
<li>动态库中的GOT.PLT表与主程序中的GOT.PLT表是否为同一份？<ul>
<li>答：同样不是同一份</li>
</ul>
</li>
<li>PLT表是代码还是数据？<ul>
<li>这个是代码，不是数据。虽然&lt;自我修养&gt;中说是一个个的项</li>
</ul>
</li>
<li>动态库内部函数之间的调用为何不直接使用相对地址调用？<ul>
<li>因为有全局符号介入的存在.导致实际调用有可能不是调用自己的函数的情况。<br>上面并没有论证<code>.got</code>是否为同一个，看完上面的内容，或许你已经有了答案。</li>
</ul>
</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>[1] <a target="_blank" rel="noopener" href="https://www.zhihu.com/question/21249496">Linux动态链接为什么要用PLT和GOT表？</a><br>[2] <a target="_blank" rel="noopener" href="https://blog.werner.wiki/elf-plt-got-static-analysis/">ELF 文件 PLT 和 GOT 静态分析</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.phaero.cn">Phaero</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.phaero.cn/2024/11/13/transship/%E8%BD%AC%E8%BD%BD0005-plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A85/">https://blog.phaero.cn/2024/11/13/transship/%E8%BD%AC%E8%BD%BD0005-plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A85/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.phaero.cn" target="_blank">Phaero的世外桃源</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%BD%AC%E8%BD%BD/">转载</a><a class="post-meta__tags" href="/tags/glibc/">glibc</a><a class="post-meta__tags" href="/tags/plt/">plt</a><a class="post-meta__tags" href="/tags/got/">got</a><a class="post-meta__tags" href="/tags/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5/">动态链接</a><a class="post-meta__tags" href="/tags/%E9%87%8D%E5%AE%9A%E4%BD%8D/">重定位</a></div><div class="post-share"><div class="social-share" data-image="/image/sky.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2024/11/14/ctfpwn/pwn-%E7%9F%A5%E8%AF%86%E7%82%B9%E6%B1%87%E6%80%BB/" title="pwn 知识点汇总"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">pwn 知识点汇总</div></div><div class="info-2"><div class="info-item-1">前言本篇只给出原博客地址，方便review而已。 正文重要工具 pwntools   计算机指令系统指令寻址 鸫鸫鹅（知乎）：关于寻址方式一篇就够了  栈溢出前置知识plt表与got表及elf的安全属性 转载0001-plt表和got表1 转载0002-plt表和got表2 转载0003-plt表和got表3 转载0004-plt表和got表4 转载0005-plt表和got表5 elf的安全属性   ASLR ASLR、PIE和PIC的异同   函数调用与栈基本知识 Jwizard（知乎）：手把手教你栈溢出从入门到放弃（上）  ret2text 自己做ctfshow上ret2text题的WP   ret2libc 自己做ctfshow上ret2libc题的WP  </div></div></div></a><a class="pagination-related" href="/2024/11/13/transship/%E8%BD%AC%E8%BD%BD0004-plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A84/" title="转载0004 plt表和got表4"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">转载0004 plt表和got表4</div></div><div class="info-2"><div class="info-item-1">前言这是转载于CSDN的文章，仅用作存储，遵循 CC 4.0 BY-SA版权协议。 聊聊Linux动态链接中的PLT和GOT（4）—— 穿针引线 原作者：海枫 正文编译时的PLT和GOT关系图前几篇文章一直在讨论PLT和GOT的结构细节，编译完成之后，PLT和GOT的对应关系是怎么样的呢，下面是编译完成之后，PLT和GOT关系图。  图中重点标注了从调用printf函数语句的汇编指令call puts@plt跳转过程，图中使用编号来表标跳转顺序。 PLT表结构有以下特点：  PLT表中的第一项为公共表项，剩下的是每个动态库函数为一项（当然每项是由多条指令组成的，jmp *0xXXXXXXXX这条指令是所有plt的开始指令） 每项PLT都从对应的GOT表项中读取目标函数地址  GOT表结构有以下特点：  GOT表中前3个为特殊项，分别用于保存...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2024/11/13/transship/%E8%BD%AC%E8%BD%BD0001-plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A81/" title="转载0001 plt表和got表1"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-13</div><div class="info-item-2">转载0001 plt表和got表1</div></div><div class="info-2"><div class="info-item-1">前言这是转载于CSDN的文章，仅用作存储，遵循 CC 4.0 BY-SA版权协议。 聊聊Linux动态链接中的PLT和GOT（1）——何谓PLT与GOT 原作者：海枫 正文为什么要PLT和GOT在介绍PLT和GOT出场之前，先以一个简单的例子引入两个主角，各位请看以下代码：12345678910111213#include &lt;stdio.h&gt;void print_banner()&#123;    printf(&quot;Welcome to World of PLT and GOT\n&quot;);&#125;int main(void)&#123;    print_banner();    return 0;&#125;编译:1gcc -Wall -g -o test.o -c test.c -m32链接:1gcc -o test test.o...</div></div></div></a><a class="pagination-related" href="/2024/11/13/transship/%E8%BD%AC%E8%BD%BD0002-plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A82/" title="转载0002 plt表和got表2"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-13</div><div class="info-item-2">转载0002 plt表和got表2</div></div><div class="info-2"><div class="info-item-1">前言这是转载于CSDN的文章，仅用作存储，遵循 CC 4.0...</div></div></div></a><a class="pagination-related" href="/2024/11/13/transship/%E8%BD%AC%E8%BD%BD0003-plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A83/" title="转载0003 plt表和got表3"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-13</div><div class="info-item-2">转载0003 plt表和got表3</div></div><div class="info-2"><div class="info-item-1">前言这是转载于CSDN的文章，仅用作存储，遵循 CC 4.0 BY-SA版权协议。 聊聊Linux动态链接中的PLT和GOT（３）——公共GOT表项 原作者：海枫 正文前文（转载2），提到所有动态库函数的plt指令最终都跳进公共plt执行，那么公共plt指令里面的地址是什么鬼？ 把test可执行文的共公plt贴出来： 1234080482a0 &lt;common@plt&gt;: 80482a0:  pushl 0x80496f0 80482a6:  jmp *0x80496f4 ... 第一句，pushl 0x80496f0，是将地址压到栈上，也即向最终调用的函数传递参数。第二句，jmp *0x80496f4，这是跳到最终的函数去执行，不过猜猜就能想到，这是跳到能解析动态库函数地址的代码里面执行。 0x80496f4里面住着是何方圣呢？下面使用gdb调试器将它请出来： 123456789101112$ gdb -q ./test...(gdb)x/xw 0x80496f40x80496f4 &lt;_GLOBAL_OFFSET_TABLE_+8&gt;:   ...</div></div></div></a><a class="pagination-related" href="/2024/11/13/transship/%E8%BD%AC%E8%BD%BD0004-plt%E8%A1%A8%E5%92%8Cgot%E8%A1%A84/" title="转载0004 plt表和got表4"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-13</div><div class="info-item-2">转载0004 plt表和got表4</div></div><div class="info-2"><div class="info-item-1">前言这是转载于CSDN的文章，仅用作存储，遵循 CC 4.0 BY-SA版权协议。 聊聊Linux动态链接中的PLT和GOT（4）—— 穿针引线 原作者：海枫 正文编译时的PLT和GOT关系图前几篇文章一直在讨论PLT和GOT的结构细节，编译完成之后，PLT和GOT的对应关系是怎么样的呢，下面是编译完成之后，PLT和GOT关系图。  图中重点标注了从调用printf函数语句的汇编指令call puts@plt跳转过程，图中使用编号来表标跳转顺序。 PLT表结构有以下特点：  PLT表中的第一项为公共表项，剩下的是每个动态库函数为一项（当然每项是由多条指令组成的，jmp *0xXXXXXXXX这条指令是所有plt的开始指令） 每项PLT都从对应的GOT表项中读取目标函数地址  GOT表结构有以下特点：  GOT表中前3个为特殊项，分别用于保存...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/image/sky.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Phaero</div><div class="author-info-description">开心每一天吧</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://www.zhihu.com/people/xing-kong-34-94-8"><i class="fab fa-zhihu"></i><span>知乎</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%AD%A3%E6%96%87"><span class="toc-number">2.</span> <span class="toc-text">正文</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%85%E8%A7%A3%E5%86%B3%E7%9A%84%E7%96%91%E9%97%AE%EF%BC%9A"><span class="toc-number">2.1.</span> <span class="toc-text">待解决的疑问：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%87%86%E5%A4%87"><span class="toc-number">2.2.</span> <span class="toc-text">代码准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#main-c"><span class="toc-number">2.2.1.</span> <span class="toc-text">main.c</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%BA%93-add-so"><span class="toc-number">2.2.2.</span> <span class="toc-text">动态库: add.so</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#makefile"><span class="toc-number">2.2.3.</span> <span class="toc-text">makefile</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E7%BB%93%E6%9E%9C%E5%88%86%E6%9E%90"><span class="toc-number">2.3.</span> <span class="toc-text">编译结果分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90-add-so"><span class="toc-number">2.3.1.</span> <span class="toc-text">分析: add.so</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81-ebx%E7%9A%84%E5%86%85%E5%AE%B9%E6%98%AF-got-plt%E5%9F%BA%E5%9C%B0%E5%9D%80"><span class="toc-number">2.3.2.</span> <span class="toc-text">验证 ebx的内容是.got.plt基地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E4%BD%8D%E8%A1%A8"><span class="toc-number">2.3.3.</span> <span class="toc-text">重定位表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%B2%A1%E6%9C%89addthree%E7%9A%84plt%E9%A1%B9"><span class="toc-number">2.3.4.</span> <span class="toc-text">为什么没有addthree的plt项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E5%B0%BE"><span class="toc-number">2.4.</span> <span class="toc-text">结尾</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">2.5.</span> <span class="toc-text">参考</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/14/ctfpwn/knowledge/pwn%E7%9F%A5%E8%AF%86%E7%82%B92-ASLR-PIE%E5%92%8CPIC%E7%9A%84%E5%BC%82%E5%90%8C/" title="pwn知识点2 ASLR,PIE和PIC的异同">pwn知识点2 ASLR,PIE和PIC的异同</a><time datetime="2024-11-14T10:22:30.000Z" title="发表于 2024-11-14 18:22:30">2024-11-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/14/ctfpwn/knowledge/pwn%E7%9F%A5%E8%AF%86%E7%82%B91-elf%E7%9A%84%E5%AE%89%E5%85%A8%E5%B1%9E%E6%80%A7/" title="pwn知识点1 elf的安全属性">pwn知识点1 elf的安全属性</a><time datetime="2024-11-14T10:19:10.000Z" title="发表于 2024-11-14 18:19:10">2024-11-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/14/ctfpwn/wp/ctfshow-pwn26-31-WP/" title="ctfshow pwn26-31 WP">ctfshow pwn26-31 WP</a><time datetime="2024-11-14T10:13:35.000Z" title="发表于 2024-11-14 18:13:35">2024-11-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/14/ctfpwn/wp/ctfshow-pwn24-WP/" title="ctfshow-pwn24 WP">ctfshow-pwn24 WP</a><time datetime="2024-11-14T05:33:42.000Z" title="发表于 2024-11-14 13:33:42">2024-11-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/14/ctfpwn/tools/pwn%E5%B7%A5%E5%85%B75-objdump/" title="pwn工具5 objdump">pwn工具5 objdump</a><time datetime="2024-11-14T02:36:23.000Z" title="发表于 2024-11-14 10:36:23">2024-11-14</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2024 By Phaero</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }
      
      const script = document.createElement('script')
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>